FROM ubuntu:24.04

# avoid interactive prompts during package install
ENV DEBIAN_FRONTEND=noninteractive

# install prerequisites, add Microsoft repo, install PowerShell
RUN apt-get update \
 && apt-get install -y --no-install-recommends \
      ca-certificates \
      curl \
      apt-transport-https \
      gnupg \
 && curl -fsSL -o /tmp/packages-microsoft-prod.deb \
      https://packages.microsoft.com/config/ubuntu/24.04/packages-microsoft-prod.deb \
 && dpkg -i /tmp/packages-microsoft-prod.deb \
 && apt-get update \
 && apt-get install -y --no-install-recommends powershell \
 && rm -f /tmp/packages-microsoft-prod.deb \
 && apt-get clean \
 && rm -rf /var/lib/apt/lists/*

ARG GO_VERSION=1.25.1

RUN echo "Installing Go ${GO_VERSION}..."

RUN curl -fsSL "https://go.dev/dl/go${GO_VERSION}.linux-amd64.tar.gz" -o go.tar.gz && \
    rm -rf /usr/local/go && \
    tar -C /usr/local -xzf go.tar.gz && \
    rm go.tar.gz

ENV PATH="/usr/local/go/bin:${PATH}"

RUN go version

WORKDIR /app
COPY . /app

RUN chmod +x /app/install.sh && \
  chmod +x /app/install.ps1

CMD [ "bash" ]
